<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">
    <title>{% if page.title %}{{ page.title }} - {% endif %}Taemin Park</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" 
          integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    
    <!-- AOS CSS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Compiled SCSS -->
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/site.css">

    <!-- MathJax -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            chtml: {
                linebreaks: { automatic: true, width: 'container' }
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav id="navbar" class="navbar fixed-top" role="navigation" aria-label="Main navigation">
        <div class="container-fluid justify-content-center">
            <ul class="navbar-nav d-flex flex-row">
                <li class="nav-item">
                    <a class="nav-link nav-brand" href="{{ site.baseurl }}/index.html" aria-label="Go to home page">Taemin Park</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ site.baseurl }}/blogs.html" aria-label="Go to blog page">Blog</a>
                </li>
                <li class="nav-item">
                    <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle dark mode" aria-pressed="false">
                        <span class="theme-toggle-icon" aria-hidden="true">🌙</span>
                        <span class="theme-toggle-text">Dark</span>
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    {{ content }}

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-name">
                <span>© {{ site.time | date: '%Y' }} Taemin Park</span>
            </div>
            <div class="footer-social">
                <a href="https://github.com/taemincode" target="_blank" rel="noopener noreferrer" aria-label="Visit Taemin's GitHub profile">
                    <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.546-1.385-1.335-1.755-1.335-1.755-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.605-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 21.795 24 17.295 24 12c0-6.63-5.37-12-12-12"></path>
                    </svg>
                </a>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    
    <!-- Typed.js -->
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>
    
    <!-- AOS JS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Theme persistence
            try {
                const stored = localStorage.getItem('theme');
                if(stored === 'dark' || stored === 'light') {
                    document.documentElement.setAttribute('data-theme', stored);
                }
            } catch(e) {}

            // Navbar scroll effect
            const navbar = document.getElementById("navbar");
            
            function handleScroll() {
                if (window.scrollY > 50) {
                    navbar.classList.add("scrolled");
                } else {
                    navbar.classList.remove("scrolled");
                }
            }
            
            window.addEventListener("scroll", handleScroll);
            handleScroll();

            // Initialize AOS (disabled on mobile/touch and reduced motion)
            AOS.init({
                duration: 600,
                once: true,
                offset: 120,
                disable: function(){
                    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                    const isTouchOrCoarse = window.matchMedia('(hover: none), (pointer: coarse)').matches;
                    const isSmallScreen = window.matchMedia('(max-width: 768px)').matches;
                    return prefersReduced || isTouchOrCoarse || isSmallScreen;
                }
            });

            // Initialize Typed.js
            if (document.getElementById('typed-text')) {
                new Typed('#typed-text', {
                    strings: ['Student developer', 'AI experimenter', 'Learning by building'],
                    typeSpeed: 50,
                    backSpeed: 30,
                    backDelay: 2000,
                    loop: true
                });
            }

            // Optional: expose a toggle function (you can bind to a button later)
            const themeBtn = document.getElementById('theme-toggle');
            function applyThemeUI(theme){
                if(!themeBtn) return;
                const isDark = theme === 'dark';
                themeBtn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
                const icon = themeBtn.querySelector('.theme-toggle-icon');
                const text = themeBtn.querySelector('.theme-toggle-text');
                if(icon) icon.textContent = isDark ? '☀️' : '🌙';
                if(text) text.textContent = isDark ? 'Light' : 'Dark';
                themeBtn.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
            }
                        window.toggleTheme = function(){
                                const root = document.documentElement;
                                const current = root.getAttribute('data-theme');
                                const next = current === 'dark' ? 'light' : 'dark';
                                root.setAttribute('data-theme', next);
                                try { localStorage.setItem('theme', next); } catch(e) {}
                                applyThemeUI(next);
                                // Remove persistent hover/focus styles after click
                                if(themeBtn){
                                    themeBtn.blur();
                                    themeBtn.classList.remove('is-active-hover');
                                }
                        };
            if(themeBtn){
                themeBtn.addEventListener('mousedown', () => themeBtn.dataset.mouseDown = '1');
                themeBtn.addEventListener('click', (e) => {
                    window.toggleTheme();
                    // If activated by mouse, blur to clear hover look; keep focus for keyboard
                    if(themeBtn.dataset.mouseDown){
                        themeBtn.blur();
                        delete themeBtn.dataset.mouseDown;
                    }
                });
                themeBtn.addEventListener('keyup', e => { if(e.key === 'Enter' || e.key === ' ') { window.toggleTheme(); } });
                applyThemeUI(document.documentElement.getAttribute('data-theme'));
            }

            // Add copy buttons to code blocks
            const codeBlocks = document.querySelectorAll('.markdown pre');
            codeBlocks.forEach((pre, index) => {
                if(pre.querySelector('.code-copy-btn')) return; // idempotent
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'code-copy-btn';
                btn.setAttribute('aria-label', 'Copy code to clipboard');
                btn.innerHTML = '<span class="copy-icon" aria-hidden="true">📋</span>';
                pre.appendChild(btn);
                const code = pre.querySelector('code');
        btn.addEventListener('click', async () => {
                    const text = code ? code.innerText : pre.innerText;
                    try {
                        await navigator.clipboard.writeText(text);
                        btn.classList.add('copied');
            btn.innerHTML = '<span class="copy-icon" aria-hidden="true">✓</span>';
                        btn.setAttribute('aria-label','Copied!');
            setTimeout(() => {
                            btn.classList.remove('copied');
                            btn.innerHTML = '<span class="copy-icon" aria-hidden="true">📋</span>';
                            btn.setAttribute('aria-label','Copy code to clipboard');
            }, 3000); // extended cool time
                    } catch(err) {
                        btn.innerHTML = '<span class="copy-icon" aria-hidden="true">⚠️</span>';
                        btn.setAttribute('aria-label','Copy failed');
                        setTimeout(() => {
                            btn.innerHTML = '<span class="copy-icon" aria-hidden="true">📋</span>';
                            btn.setAttribute('aria-label','Copy code to clipboard');
                        }, 2000);
                    }
                });
            });
        });
    </script>
</body>
</html>
